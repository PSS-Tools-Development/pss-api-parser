from . import constants as _constants
{% for service in services %}
from .services import {{ service.name }} as _{{ service.name }}
{% endfor %}
from .enums import DeviceType as _DeviceType
from .enums import LanguageKey as _LanguageKey


class PssApiClientBase:
    def __init__(self, device_type: _DeviceType = None, language_key: _LanguageKey = None, production_server: str = None) -> None:
        self.__device_type: _DeviceType = device_type or _DeviceType.DEVICE_TYPE_ANDROID
        self.__language_key: _LanguageKey = language_key or _LanguageKey.ENGLISH
        self.__production_server: str = production_server

    @classmethod
    async def create(cls, device_type: _DeviceType = None, language_key: _LanguageKey = None, production_server: str = None):
        self = cls(device_type, language_key, production_server)

        if not self.production_server:
            await self.init_production_server()

        self._update_services()

        return self

    @property
    def device_type(self) -> _DeviceType:
        return self.__device_type

    @property
    def language_key(self) -> _LanguageKey:
        return self.__language_key

    @property
    def production_server(self) -> str:
        return self.__production_server

    @production_server.setter
    def production_server(self, value):
        self.__production_server = value
{% for service in services %}

    @property
    def {{ service.name_snake_case }}(self) -> _{{ service.name }}:
        return self.__{{ service.name_snake_case }}
{% endfor %}

    async def init_production_server(self) -> None:
        setting_service = _SettingService(
            _constants.DEFAULT_PRODUCTION_SERVER, self.language_key
        )

        settings = await setting_service.get_latest_version(self.device_type)
        self.production_server = settings[0].production_server


    def _update_services(self) -> None:
{% for service in services %}
        self.__{{ service.name_snake_case }}: _{{ service.name }} = _{{ service.name }}(self.production_server, self.language_key)
{% endfor %}
